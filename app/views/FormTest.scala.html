@*
 * Copyright (c) Salesforce.com, inc. 2017
 *@

@this(mainView: Main, webJarsUtil: org.webjars.play.WebJarsUtil)

@(userInfo: _root_.utils.UserInfo, tasks: Map[String, Task.Prototype])(implicit request: RequestHeader)

@extraHead() =  {
    @webJarsUtil.locate("jsoneditor.min.css").css()
    @webJarsUtil.locate("jsoneditor.min.js").script()
}

@mainView(Some(userInfo))("Form Test", extraHead()) {

    <form class="form-inline">
        <div class="form-group">
            <label for="formSelect">Form to Test</label>
            <select id="formSelect" class="form-control input-small">
                <option disabled selected>Select a Form</option>
                @for(task <- tasks) {
                    @for(form <- task._2.form) {
                        <option value="@task._1" data-json="@JavaScript(form.toString())">@task._2.label</option>
                    }
                }
            </select>
        </div>
    </form>

    <div id="jsoneditor" style="height: 600px; margin-top: 20px;"></div>

    <button id="tryit" class="btn btn-default btn-block" style="margin-top: 20px">Try it!</button>

    <div id="form" class="well" style="margin-top: 20px"></div>


    <script type="text/javascript">
        var container = document.getElementById("jsoneditor");
        var editor = new JSONEditor(container, {"mode": "code"});
        var form = $("#form");

        function render(event) {
            event.preventDefault();
            form.empty();
            try {
                var json = editor.get();
                form.alpaca(json);
            } catch (e) {
              form.text(e.message);
            }
        }

        $("#tryit").click(render);

        $("#formSelect").change(function() {
          var json = $(this).find(':selected').data('json');
          editor.set(json);
        });
    </script>

}
