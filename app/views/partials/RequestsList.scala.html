@*
 * Copyright (c) 2018, Salesforce.com, Inc.
 * All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 * For full license text, see the LICENSE.txt file in the repo root or https://opensource.org/licenses/BSD-3-Clause
 *@

@(requests: Seq[RequestWithTasks])

@stateClass(state: models.State.State) = {
    @state match {
        case models.State.InProgress => {
            list-group-item-info
        }
        case models.State.Cancelled => {
            list-group-item-warning
        }
        case models.State.Completed => {
            list-group-item-success
        }
    }
}

@if(requests.nonEmpty) {
    <div class="list-group">
    @for(requestWithTasks <- requests) {
        <a href="@routes.Application.request(requestWithTasks.request.slug)" class="list-group-item @stateClass(requestWithTasks.request.state)">
            <span class="badge" style="margin-top: 25px;">@requestWithTasks.completedTasks.size of @requestWithTasks.tasks.size tasks completed</span>
            <h4>@requestWithTasks.request.name</h4>
            @requestWithTasks.request.completedDate match {
                case Some(completedDate) if requestWithTasks.request.state == State.Completed => {
                    <p>
                    @defining(Tasks.conditionalApprovals(requestWithTasks.tasks)) { conditionalApprovalMessages =>
                        @if(conditionalApprovalMessages.isEmpty) {
                            Approved on @views.utils.DateTime.date(completedDate)
                        } else {
                            Conditionally approved on @views.utils.DateTime.date(completedDate) @conditionalApprovalMessages.mkString("(", ", ", ")")
                        }
                    }
                    </p>
                }
                case None => {
                    <p>Created @views.utils.DateTime.date(requestWithTasks.request.createDate) by @requestWithTasks.request.creatorEmail</p>
                }
            }
        </a>
    }
    </div>
} else {
    No requests!
}
