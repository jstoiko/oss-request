@*
 * Copyright (c) Salesforce.com, inc. 2017
 *@

@this()

@(taskPrototype: models.Task.Prototype, nameOrTaskId: Either[String, Int])

@formUrl = @{
    nameOrTaskId match {
        case Left(name) => routes.Application.newRequest(Some(name)).url
        case Right(taskId) => routes.Application.updateTask(taskId).url
    }
}

@(taskPrototype.`type`) match {
    case models.Task.TaskType.Input => {
        @defining(scala.util.Random.alphanumeric.take(8).mkString) { formid =>
            @for(form <- taskPrototype.form) {
                <div id="@formid"></div>
                <script>
                    (function() {
                        const form = @Html(form.toString());

                        form.options.form = {
                            attributes: {
                                action: "@formUrl",
                                method: "post"
                            },
                            buttons: {
                                submit: {
                                    click: function () {
                                        if (this.isValid(true)) {
                                            const config = {
                                                data: JSON.stringify(this.getValue()),
                                                contentType: "application/json"
                                            };
                                            this.ajaxSubmit(config).done(function(data) {
                                                if (data.requestId !== undefined) {
                                                    window.location = "/request?id=" + data.requestId;
                                                }
                                                else {
                                                    window.location = "/request?id=" + data.id;
                                                }
                                            });
                                        }
                                        else {
                                            console.error(this.getValue());
                                        }
                                    }
                                }
                            }
                        };

                        $("#@formid").alpaca(form);
                    })();
                </script>
            }
        }
    }
    case models.Task.TaskType.Action => {
        Action Needed
    }
    case models.Task.TaskType.Approval => {
        Approval Needed
    }
}

@*
        case Some(State.Completed) => {
            @taskPrototype.`type` match {
                case Task.TaskType.Action => {

                }
                case Task.TaskType.Approval => {

                }
                case Task.TaskType.InputNeeded => {
                    @for(form <- taskPrototype.form) {
                        <div id="@formid"></div>
                        <script>
                            (function() {
                                const form = @Html(formWithData(form).toString);
                                $("#@formid").alpaca(form);
                            })();
                        </script>
                    }
                }
            }
        }

        case _ => {
            Render ???
        }
    }

}
*@
